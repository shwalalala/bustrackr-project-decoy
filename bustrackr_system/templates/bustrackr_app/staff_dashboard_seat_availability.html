{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seat Availability</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  
  <!-- FlyonUI CDN -->
  <link href="https://cdn.jsdelivr.net/npm/flyonui@2.4.1/dist/css/flyonui.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="{% static 'bustrackr_app/css/output.css' %}">
  <link rel="stylesheet" href="{% static 'bustrackr_app/css/bustrackr_unified.css' %}">
  <link rel="stylesheet" href="{% static 'bustrackr_app/css/alerts.css' %}">
</head>

<body>

{% include 'components/sidebar.html' %}

<div class="main-content p-4">

  <!-- <h3 class="mb-3 bold-spaced">Seat Availability</h3> -->

  <div class="card p-3 bus-table">
    <table class="table table-striped">
      <thead>
          <tr>
              <th>Plate No.</th>
              <th>Route</th>
              <th>Departure</th>
              <th>Arrival</th>
              <th class="align-middle">Capacity</th>
              <th class="align-middle">Passengers On Board</th>
              <th class="align-middle">Available Seats</th>
              <th >Actions</th>
          </tr>
      </thead>

      <tbody id="scheduleTableBody">
        {% for sched in schedules %}
        {% for bus in buses %}
        {% if bus.id == sched.bus_id %}
        <tr id="schedule-{{ sched.id }}" data-schedule-id="{{ sched.id }}">
            <td>{{ bus.plate_number }}</td>
            <td>{{ sched.route }}</td>
            <td>{{ sched.departure_time|time:"g:i A" }}</td>
            <td>{{ sched.arrival_time|time:"g:i A" }}</td>
            <td class="align-middle">{{ bus.capacity }}</td>
            <td class="passengers-cell">{{ sched.passengers_onboard }}</td>
            <td class="available-seats-cell">{{ sched.available_seats }}</td>

            <!-- ADD / SUBTRACT BUTTONS -->
            <td>
                <button 
                  class="btn btn-success btn-sm"
                  onclick="openSeatModal(
                    '{{ sched.id }}',
                    '{{ bus.plate_number }}',
                    '{{ bus.capacity }}',
                    '{{ sched.available_seats|default:bus.capacity }}',
                    'add'
                  )">
                  +
                </button>

                <button 
                  class="btn btn-danger btn-sm"
                  onclick="openSeatModal(
                    '{{ sched.id }}',
                    '{{ bus.plate_number }}',
                    '{{ bus.capacity }}',
                    '{{ sched.available_seats|default:bus.capacity }}',
                    'subtract'
                  )">
                  â€“
                </button>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
        {% endfor %}
    </tbody>
    </table>
  </div>

</div>

{% include 'components/modals/seat_update_modal.html' %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'bustrackr_app/js/seat_availability.js' %}"></script>
<script src="{% static 'bustrackr_app/js/confirmation_modal.js' %}"></script>

</body>
</html>
