{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seat Availability</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'bustrackr_app/css/output.css' %}">
  <link rel="stylesheet" href="{% static 'bustrackr_app/css/dashboard_common.css' %}">
</head>

<body>

{% include 'components/sidebar.html' %}

<div class="main-content p-4">

  <h3 class="mb-3">Seat Availability</h3>

  <div class="card p-3 bus-table">
    <table class="table table-striped">
      <thead>
          <tr>
              <th>Plate No.</th>
              <th>Route</th>
              <th>Departure</th>
              <th>Arrival</th>
              <th>Capacity</th>
              <th>Passengers On Board</th>
              <th>Available Seats</th>
              <th>Actions</th>
          </tr>
      </thead>

      <tbody>
          {% for sched in schedules %}
          {% for bus in buses %}
          {% if bus.id == sched.bus_id %}
          <tr>
              <td>{{ bus.plate_number }}</td>
              <td>{{ sched.route }}</td>
              <td>{{ sched.departure_time|time:"g:i A" }}</td>
              <td>{{ sched.arrival_time|time:"g:i A" }}</td>

              <!-- Capacity -->
              <td>{{ bus.capacity }}</td>

              <!-- Passengers On Board -->
              <td>{{ sched.passengers_onboard }}</td>

              <!-- Available Seats -->
              <td>{{ sched.available_seats }}</td>

              <!-- ADD / SUBTRACT BUTTONS -->
              <td>
                  <button 
                    class="btn btn-success btn-sm"
                    onclick="openSeatModal(
                      '{{ sched.id }}',
                      '{{ bus.plate_number }}',
                      '{{ bus.capacity }}',
                      '{{ sched.available_seats|default:bus.capacity }}',
                      'add'
                    )">
                    +
                  </button>

                  <button 
                    class="btn btn-danger btn-sm"
                    onclick="openSeatModal(
                      '{{ sched.id }}',
                      '{{ bus.plate_number }}',
                      '{{ bus.capacity }}',
                      '{{ sched.available_seats|default:bus.capacity }}',
                      'subtract'
                    )">
                    â€“
                  </button>
              </td>
          </tr>
          {% endif %}
          {% endfor %}
          {% endfor %}
      </tbody>
    </table>
  </div>

</div>

{% include 'components/modals/seat_update_modal.html' %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
function openSeatModal(scheduleId, plate, capacity, availableSeats, operation) {
    document.getElementById("scheduleIdField").value = scheduleId;
    document.getElementById("operationField").value = operation;

    document.getElementById("modalBusPlate").innerText = plate;
    document.getElementById("modalCapacity").innerText = capacity;
    document.getElementById("modalAvailable").innerText = availableSeats;

    const modal = new bootstrap.Modal(document.getElementById("seatUpdateModal"));
    modal.show();
}
</script>

</body>
</html>
